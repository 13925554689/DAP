# 审计功能手动编辑需求深度分析
## 自动化与人工判断的最佳平衡方案

**文档版本**: v1.0
**制定日期**: 2024-11-22
**核心理念**: **智能辅助,人工决策;自动优先,手动兜底**

---

## 📋 一、各功能模块手动编辑需求分析

### 1. 项目管理 - 手动编辑需求 ⭐⭐⭐⭐⭐

#### **自动化部分** ✅
```
├─ 项目编号自动生成 (P20241122001)
├─ 会计期间自动推算 (根据报表日期)
├─ 项目模板应用 (年报审计/IPO审计等)
└─ 审计组成员自动分配 (基于工作量)
```

#### **必须手动的部分** ⚠️
```
1. 项目基本信息
   ├─ 客户名称 (可能有简称、全称差异)
   ├─ 特殊约定 (如提前结束、延期等)
   ├─ 重要性水平 (需要项目经理判断)
   └─ 风险评级 (高/中/低,专业判断)

2. 合并范围确定
   ├─ 虽持股但无控制权的公司 → 手动排除
   ├─ 持股不足50%但有实质控制 → 手动纳入
   └─ 结构化主体判断 → 完全人工判断

3. 审计组调整
   ├─ 成员临时变更 (离职、请假)
   ├─ 专家引入 (IT审计、评估专家)
   └─ 权限特殊分配 (某人只能查看不能编辑)

4. 项目里程碑
   ├─ 关键时间节点 (预审、终审、报告日)
   ├─ 特殊事项提醒 (如监管检查、客户上市时间)
   └─ 项目暂停/恢复
```

#### **最佳方案** 💡
```
界面设计:
┌─────────────────────────────────────────────┐
│ 项目创建向导                                 │
├─────────────────────────────────────────────┤
│ 第1步: 基本信息 (手动填写)                   │
│   ├─ 客户名称: [___________]  [从历史选择▼] │
│   ├─ 项目类型: [年报审计▼]    [模板库...]   │
│   ├─ 会计期间: [2024-01] 至 [2024-12] ✏️    │
│   └─ 项目编号: P20241122001  (自动生成)✓    │
│                                              │
│ 第2步: 合并范围 (半自动+手动确认)            │
│   系统识别到 3 家子公司:                     │
│   ☑ 子公司A (持股100%) [自动纳入]           │
│   ☑ 子公司B (持股60%)  [自动纳入]           │
│   ☐ 子公司C (持股30%)  [系统建议排除] ✏️    │
│       └─ ✏️ 修改理由: 虽持股30%,但通过协议 │
│              享有实质控制权,应纳入合并      │
│   [+ 手动添加实体]                          │
│                                              │
│ 第3步: 审计组 (模板+手动调整)                │
│   根据项目规模,系统推荐:                     │
│   ├─ 合伙人: 李总      [修改▼]              │
│   ├─ 项目经理: 王经理   [修改▼]              │
│   ├─ 项目组长: 张组长   [修改▼]              │
│   └─ 审计员: 系统推荐3人 [✏️调整人数和人选]  │
│                                              │
│ [上一步] [下一步] [保存草稿]                 │
└─────────────────────────────────────────────┘

核心原则:
✅ 自动生成默认值,但所有字段可编辑
✅ 关键判断项强制人工确认 (如合并范围)
✅ 提供智能建议,但最终决策权在人
```

---

### 2. 审计底稿编制 - 手动编辑需求 ⭐⭐⭐⭐⭐

#### **自动化部分** ✅
```
├─ 从数据库自动取数 (科目余额、凭证明细)
├─ 底稿模板自动应用 (货币资金审定表等)
├─ 索引号自动生成 (A-1-01, B-2-03...)
├─ 期初数自动结转 (从上期底稿)
└─ 简单计算自动完成 (合计、差额等)
```

#### **必须手动的部分** ⚠️
```
1. 数据验证与调整
   问题: 自动取数可能不准确
   示例场景:
   ├─ 银行存款自动取数: 10,500,000
   ├─ 审计发现: 有200,000是受限资金(质押)
   └─ 手动操作:
       ├─ ✏️ 修改科目分类: 200,000 → 其他非流动资产
       ├─ ✏️ 添加调整分录
       └─ ✏️ 批注说明: "XX银行存款200万系质押,已重分类"

2. 审计程序执行记录
   问题: 审计工作需要人工执行和记录
   示例场景:
   ├─ 自动生成: 货币资金审定表 (数据已填充)
   └─ 手动补充:
       ├─ ✏️ 审计程序: "已执行银行函证,回函相符"
       ├─ ✏️ 附件上传: 银行对账单扫描件
       ├─ ✏️ 异常说明: "XX银行未回函,已执行替代程序"
       └─ ✏️ 审计结论: "经审计,银行存款余额公允反映"

3. 特殊调整分录
   问题: 复杂的会计调整无法自动生成
   示例场景:
   ├─ 发现问题: 固定资产折旧政策不当
   └─ 手动操作:
       ├─ ✏️ 编制审计调整分录:
       │    借: 管理费用-折旧   500,000
       │    贷: 累计折旧        500,000
       ├─ ✏️ 调整说明: "XX设备折旧年限应为10年,
       │              客户按5年计提,建议调整"
       └─ ✏️ 与客户沟通记录: "已与财务总监沟通,
                              客户同意调整"

4. 底稿格式个性化
   问题: 标准模板不能满足所有情况
   示例场景:
   ├─ 标准模板: 应收账款账龄分析表 (5列)
   └─ 客户特殊性: 需要按销售区域+账龄二维分析
       └─ 手动操作:
           ├─ ✏️ 修改表格结构 (增加"区域"维度)
           ├─ ✏️ 调整公式和合计逻辑
           └─ ✏️ 保存为自定义模板 (下次可复用)

5. 分析性复核
   问题: 比率分析需要专业判断
   示例场景:
   ├─ 系统计算: 毛利率 28.5% (去年 30.2%)
   ├─ 自动预警: ⚠️ 毛利率下降1.7%,请关注
   └─ 手动分析:
       └─ ✏️ 分析师填写:
           "毛利率下降主要原因:
            1. 原材料价格上涨15%
            2. 产品结构调整,低毛利产品占比提升
            3. 已与管理层讨论,属正常经营变化
            4. 已执行成本测试,未发现重大异常"
```

#### **最佳方案** 💡
```
底稿编辑器界面:
┌──────────────────────────────────────────────────┐
│ 审计底稿: A-1-01 银行存款审定表                   │
├──────────────────────────────────────────────────┤
│ [自动取数] [手动编辑] [插入调整] [添加批注]       │
├──────────────────────────────────────────────────┤
│ 数据来源: ✅自动取数 (2024-11-22 10:30更新)       │
│           [🔄重新取数] [✏️切换为手动编辑模式]     │
├──────────────────────────────────────────────────┤
│ ┌────────────────────────────────────────────┐  │
│ │ 序号 │ 银行名称 │ 账号 │ 账面余额 │ 审定余额│  │
│ ├──────┼─────────┼─────┼─────────┼────────┤  │
│ │  1   │工商银行  │622..│5,000,000 │5,000,000│  │
│ │  2   │建设银行  │436..│3,500,000 │3,500,000│  │
│ │  3   │农业银行  │955..│2,000,000 │2,000,000│ ✏️│
│ │      │          │     │          │[手动修改]│  │
│ ├──────┴─────────┴─────┼─────────┼────────┤  │
│ │ 合计                 │10,500,000│10,500,000│  │
│ │ 其中: 受限资金       │   200,000│  200,000│✏️│
│ │       可动用资金     │10,300,000│10,300,000│  │
│ └─────────────────────┴─────────┴────────┘  │
│                                                  │
│ 📝 审计程序执行记录: (手动填写)                  │
│ ┌────────────────────────────────────────────┐  │
│ │ ✏️ [点击编辑审计程序]                       │  │
│ │ 1. 已对3家银行执行函证,回函相符             │  │
│ │ 2. 已获取银行对账单,与账面核对一致           │  │
│ │ 3. 农业银行200万系质押存款,已重分类          │  │
│ │ 4. 未发现重大异常事项                       │  │
│ └────────────────────────────────────────────┘  │
│                                                  │
│ 💬 批注: (1条未解决)                             │
│ 复核人(李经理): "请补充质押存款的质押协议"      │
│                                                  │
│ [保存] [提交复核] [导出Excel] [打印]             │
└──────────────────────────────────────────────────┘

关键设计原则:
1. 双模式切换:
   ├─ 自动模式: 从数据库实时取数,动态刷新
   └─ 手动模式: 锁定数据,允许任意编辑

2. 编辑权限控制:
   ├─ 自动取数的单元格: 默认锁定,点击"✏️"解锁编辑
   ├─ 手动编辑后: 标记"✏️已手动修改",不再自动更新
   └─ 编辑历史: 记录谁在何时修改了什么

3. 智能提示:
   ├─ 自动计算异常: "⚠️ 合计数与明细不符,请检查"
   ├─ 逻辑校验: "⚠️ 审定余额超过账面余额20%,是否正常?"
   └─ 缺失提醒: "⚠️ 审计程序执行记录为空,请补充"
```

---

### 3. 分级复核 - 手动编辑需求 ⭐⭐⭐⭐⭐

#### **自动化部分** ✅
```
├─ 复核流程自动流转 (编制→一复→二复→三复)
├─ 复核人自动分配 (根据项目组设置)
├─ 到期提醒自动发送 (邮件+站内信)
├─ 复核通过自动更新状态
└─ 复核统计自动汇总 (完成率、超期数等)
```

#### **必须手动的部分** ⚠️
```
1. 复核意见填写 ✏️
   问题: 专业判断无法自动化
   场景:
   ├─ 一级复核 (项目组长):
   │   ├─ ✏️ 审阅底稿内容
   │   ├─ ✏️ 提出修改意见: "银行存款请补充函证底稿索引"
   │   └─ ✏️ 决定: [通过] [退回修改] [存疑待讨论]
   │
   ├─ 二级复核 (项目经理):
   │   ├─ ✏️ 评估审计程序充分性
   │   ├─ ✏️ 提出补充要求: "应收账款建议扩大函证范围"
   │   └─ ✏️ 决定: [批准] [退回一复] [直接退回编制人]
   │
   └─ 三级复核 (合伙人):
       ├─ ✏️ 整体审计风险评估
       ├─ ✏️ 重大事项判断: "存货跌价准备计提不足,需追加测试"
       └─ ✏️ 最终决定: [签发报告] [暂缓签发] [重大修改]

2. 复核痕迹保留 ✏️
   审计准则要求: 复核必须留痕
   场景:
   ├─ ✏️ Excel底稿中添加批注 (红色标注修改处)
   ├─ ✏️ 系统中记录复核时间、意见、结论
   ├─ ✏️ 上传补充证据 (如重新获取的询证函)
   └─ ✏️ 修改前后版本对比 (审计档案要求)

3. 特殊审批流程 ✏️
   问题: 并非所有底稿都走标准三级复核
   场景:
   ├─ 常规底稿: 三级复核
   ├─ 简单底稿: 仅二级复核 (如银行询证函)
   ├─ 重大底稿: 需技术部会签 (如复杂金融工具)
   └─ 紧急底稿: 合伙人直接复核 (如突发事项)

   手动操作:
   └─ ✏️ 复核人可手动调整流程:
       ├─ "此底稿涉及收入确认政策,需技术部复核"
       ├─ "已电话与合伙人沟通,特批快速通道"
       └─ 系统记录调整理由和审批人

4. 复核冲突解决 ✏️
   问题: 不同层级复核意见可能冲突
   场景:
   ├─ 一复意见: "应收账款坏账准备计提充分"
   ├─ 二复意见: "建议追加10%坏账准备"
   ├─ 编制人疑惑: 听谁的?
   └─ 手动操作:
       └─ ✏️ 项目经理在系统中标注:
           "经与组长讨论,客户行业风险较高,
            采纳二复意见,追加计提10%"
```

#### **最佳方案** 💡
```
复核工作台:
┌──────────────────────────────────────────────────┐
│ 底稿复核: A-1-01 银行存款审定表                   │
├──────────────────────────────────────────────────┤
│ 当前状态: 待二级复核 (项目经理)                  │
│ 编制人: 张三      一级复核人: 李组长 ✓          │
├──────────────────────────────────────────────────┤
│ [查看底稿] [查看一复意见] [开始复核]             │
├──────────────────────────────────────────────────┤
│ 一级复核意见: (李组长 2024-11-22 14:30)          │
│ ┌────────────────────────────────────────────┐  │
│ │ ✓ 数据核对无误                              │  │
│ │ ✓ 审计程序执行充分                          │  │
│ │ ⚠️ 建议补充: 质押存款的质押协议扫描件       │  │
│ │ 复核结论: 通过,待编制人补充附件后提交二复   │  │
│ └────────────────────────────────────────────┘  │
│                                                  │
│ 编制人修改记录: (张三 2024-11-22 15:00)          │
│ ┌────────────────────────────────────────────┐  │
│ │ ✓ 已上传质押协议 (attachment_001.pdf)       │  │
│ │ ✓ 已在底稿中标注质押情况                    │  │
│ └────────────────────────────────────────────┘  │
│                                                  │
│ 二级复核意见: (王经理 - 待填写)  ✏️             │
│ ┌────────────────────────────────────────────┐  │
│ │ [✏️ 点击填写复核意见]                       │  │
│ │                                             │  │
│ │ 复核要点检查:                               │  │
│ │ ☑ 审计程序设计合理                         │  │
│ │ ☑ 审计证据充分适当                         │  │
│ │ ☐ 审计结论支持充分  ← ⚠️请关注              │  │
│ │                                             │  │
│ │ 我的意见:                                   │  │
│ │ [文本框 - 手动输入复核意见]                 │  │
│ │                                             │  │
│ │ 复核结论:                                   │  │
│ │ ○ 通过,提交三级复核                        │  │
│ │ ○ 退回修改 (退回给: [编制人▼] [一复▼])     │  │
│ │ ○ 暂缓,需补充程序                          │  │
│ │ ○ 特殊处理 (需说明): [___________]         │  │
│ │                                             │  │
│ │ [保存草稿] [提交复核意见]                  │  │
│ └────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────┘

核心设计:
1. 强制人工决策: 复核结论必须手动选择,不能自动通过
2. 意见留痕: 所有复核意见永久保存,可追溯
3. 灵活流程: 允许跨级退回、特殊审批
4. 提醒机制: 超期未复核自动提醒+升级通知
```

---

### 4. 底稿索引管理 - 手动编辑需求 ⭐⭐⭐⭐

#### **自动化部分** ✅
```
├─ 索引号自动生成 (A-1, A-2, B-1, B-2...)
├─ 索引关联自动识别 (如A-1引用B-2的数据)
├─ 索引目录自动生成 (底稿清单)
└─ 断号检测 (如缺少A-3)
```

#### **必须手动的部分** ⚠️
```
1. 索引号手动调整 ✏️
   问题: 实际审计中底稿顺序可能调整
   场景:
   ├─ 初始规划: A-1货币资金, A-2应收账款, A-3存货
   ├─ 审计发现: 存货涉及重大调整,需拆分为多个底稿
   └─ 手动调整:
       ├─ ✏️ A-3 拆分为:
       │   ├─ A-3-01 原材料审定表
       │   ├─ A-3-02 在产品审定表
       │   ├─ A-3-03 产成品审定表
       │   └─ A-3-04 存货跌价准备测试表
       ├─ ✏️ 原A-4固定资产 → 调整为A-5
       └─ 系统自动更新所有交叉引用

2. 索引关联手动维护 ✏️
   问题: 复杂的交叉引用无法全部自动识别
   场景:
   ├─ 底稿A-1 银行存款: 10,500,000
   ├─ 底稿F-1 现金流量表: 引用银行存款数据
   ├─ 系统可能无法自动识别引用关系
   └─ 手动操作:
       └─ ✏️ 在F-1底稿中手动标注:
           "银行存款数据来源: 见A-1-01"
           并建立系统内链接

3. 索引说明手动添加 ✏️
   问题: 索引号含义需要说明
   场景:
   ├─ 标准索引: A-货币资金, B-应收账款...
   ├─ 特殊索引: X-特殊事项, Y-期后事项, Z-审计调整
   └─ 手动操作:
       └─ ✏️ 在索引目录中添加说明:
           "X-1: 关联方交易特殊审计程序
            X-2: 持续经营能力分析
            Z-1至Z-15: 审计调整分录汇总表"

4. 临时底稿插入 ✏️
   问题: 审计过程中可能增加底稿
   场景:
   ├─ 已有底稿: A-1, A-2, A-3
   ├─ 现场发现: 需要补充A-2与A-3之间的分析底稿
   └─ 手动操作:
       └─ ✏️ 插入底稿编号: A-2A (或A-2-1)
           ├─ 系统提示: "检测到非标准编号,是否继续?"
           └─ 审计师确认: "是,这是临时补充底稿"
```

#### **最佳方案** 💡
```
索引管理器:
┌──────────────────────────────────────────────────┐
│ 审计底稿索引目录                                  │
├──────────────────────────────────────────────────┤
│ [自动生成索引] [手动调整] [检查断号] [导出目录]   │
├──────────────────────────────────────────────────┤
│ A. 货币资金                                       │
│   ├─ A-1 库存现金审定表        ✓ (已完成)         │
│   ├─ A-2 银行存款审定表        ✓ (已完成)  ✏️     │
│   │   └─ [修改索引号] [插入子索引] [删除]        │
│   └─ A-3 其他货币资金          ⏳ (进行中)        │
│                                                   │
│ B. 应收款项                                       │
│   ├─ B-1 应收账款账龄分析      ✓                 │
│   ├─ B-2 坏账准备测试          ✓                 │
│   ├─ B-2A 坏账准备补充测试     ✏️ (临时插入)     │
│   │   └─ 说明: 发现新增大额逾期款,补充测试      │
│   └─ B-3 应收账款函证汇总      ⏳                │
│                                                   │
│ [点击任意索引号可手动修改]                        │
│                                                   │
│ 底稿引用关系图: (智能生成+手动补充)               │
│ A-2 (银行存款)                                    │
│   ↓ 引用                                         │
│ F-1 (现金流量表)  ← ✏️ 手动建立链接             │
│   ↓ 引用                                         │
│ G-1 (财务报表审计报告)                            │
│                                                   │
│ [+ 添加引用关系] [删除关系] [查看引用链]         │
└──────────────────────────────────────────────────┘

设计原则:
1. 自动为主,手动为辅: 系统自动生成标准索引
2. 灵活调整: 允许插入、删除、重命名索引
3. 智能提示: 检测断号、重号、非标准编号
4. 引用维护: 自动+手动识别底稿间引用关系
```

---

### 5. 合并报表抵消分录 - 手动编辑需求 ⭐⭐⭐⭐⭐

#### **自动化部分** ✅
```
├─ 内部往来自动匹配 (90%准确率)
├─ 长期股权投资抵消自动生成
├─ 标准抵消分录自动计算
├─ 抵消底稿自动填充
└─ 合并报表自动汇总
```

#### **必须手动的部分** ⚠️ (最重要!)
```
1. 自动匹配结果确认 ✏️
   问题: AI匹配可能误判
   场景:
   ├─ 系统自动匹配:
   │   母公司应收"XX公司" 500万
   │   子公司应付"XX公司" 500万
   │   系统判断: 内部往来,建议抵消
   │
   └─ 审计师手动核实:
       ├─ ✏️ 查看明细: 母公司应收是"XX商贸公司"
       │              子公司应付是"XX实业公司"
       │              这是两个不同的公司!
       └─ ✏️ 操作: 取消自动匹配,标记为"非关联方"

2. 特殊抵消分录手工编制 ✏️
   问题: 复杂交易无法自动处理
   场景A: 内部销售未实现利润抵消
   ├─ 系统识别: 母公司销售给子公司 1000万,成本800万
   ├─ 自动抵消: 营业收入 1000万, 营业成本 800万
   ├─ 实际情况: 子公司已对外销售70%,库存仅30%
   └─ 手动调整:
       └─ ✏️ 仅抵消库存中未实现利润:
           借: 营业收入    300万 (1000*30%)
           借: 营业成本    240万 (800*30%)
           贷: 存货         60万 (利润*30%)

   场景B: 固定资产内部交易
   ├─ 系统无法自动处理: 母公司将账面500万的设备
   │                    以800万卖给子公司
   └─ 手动编制抵消分录:
       ✏️ 抵消交易利润:
       借: 营业外收入        300万
       贷: 固定资产-原值    300万

       ✏️ 调整折旧 (设备尚可使用10年):
       借: 累计折旧          30万
       贷: 管理费用-折旧    30万

3. 非标持股结构处理 ✏️
   问题: 复杂股权结构无法自动计算
   场景: 交叉持股
   ├─ 母公司A持有子公司B 60%
   ├─ 子公司B持有母公司A 10%
   ├─ 系统无法处理循环持股
   └─ 手动操作:
       └─ ✏️ 财务专家手工计算:
           ├─ 计算间接持股比例
           ├─ 确定合并比例
           ├─ 手动编制复杂抵消分录
           └─ 附计算过程底稿

4. 抵消分录调整与说明 ✏️
   问题: 实际情况比理论复杂
   场景: 内部借款利息
   ├─ 系统自动抵消:
   │   母公司利息收入 100万
   │   子公司利息支出 100万
   │   借: 利息收入 100万
   │   贷: 利息支出 100万
   │
   ├─ 实际情况: 借款期限跨年,计提时间差异
   │   母公司确认收入: 100万 (权责发生制)
   │   子公司实际支付: 80万 (现金制,尚有20万未付)
   │
   └─ 手动调整:
       └─ ✏️ 修改抵消分录:
           借: 利息收入     100万
           贷: 利息支出      80万
           贷: 应付利息      20万

           ✏️ 添加说明:
           "母子公司内部借款100万,年利率10%,
            应计利息10万,子公司实际支付8万,
            尚有2万未付,已计入应付利息"

5. 合并范围变动处理 ✏️
   问题: 本期新增/减少子公司
   场景: 本期新收购子公司
   ├─ 自动处理: 不可能,涉及购买日评估、商誉计算
   └─ 手动操作:
       └─ ✏️ 编制一系列手工分录:
           1. 确定购买日公允价值
           2. 计算商誉或负商誉
           3. 编制购买日抵消分录
           4. 调整可辨认净资产公允价值
           5. 附评估报告、收购协议等证据
```

#### **最佳方案** 💡
```
抵消分录工作台:
┌──────────────────────────────────────────────────────────┐
│ 合并抵消分录工作底稿 - 2024年12月                         │
├──────────────────────────────────────────────────────────┤
│ [自动生成] [手动编制] [导入Excel] [导出底稿]              │
├──────────────────────────────────────────────────────────┤
│ 一、长期股权投资抵消 (自动生成 ✓)                         │
│ ┌────┬───────┬──────┬──────┬──────┬──────┐       │
│ │序号│子公司  │借方科目│借方金额│贷方科目│贷方金额│       │
│ ├────┼───────┼──────┼──────┼──────┼──────┤       │
│ │ E-1│子公司A │实收资本│30,000  │长投    │30,000  │ ✓     │
│ │ E-2│子公司B │实收资本│20,000  │长投    │18,000  │ ✏️   │
│ │    │        │少数股东│ 2,000  │        │        │       │
│ │    │        │权益    │        │        │        │       │
│ └────┴───────┴──────┴──────┴──────┴──────┘       │
│ [✏️ 点击E-2查看详情和手动调整]                            │
│                                                           │
│ 二、内部往来抵消 (AI匹配90% ⚠️ 需人工确认)               │
│ ┌────┬─────────┬─────┬─────┬──────┬────┐      │
│ │序号│交易对手  │金额 │匹配度│状态  │操作│      │
│ ├────┼─────────┼─────┼─────┼──────┼────┤      │
│ │ E-3│A→B应收款│2,500│ 98%  │✓已确认│查看│      │
│ │ E-4│A→C应收款│1,200│ 85%  │⚠️待确认│✏️ │      │
│ │ E-5│B→C应收款│  800│ 92%  │✓已确认│查看│      │
│ │ E-6│A→"XX公司"│ 500│ 70%  │❌已拒绝│✏️ │      │
│ │    │说明:非关联方│  │     │      │    │      │
│ └────┴─────────┴─────┴─────┴──────┴────┘      │
│                                                           │
│ 点击查看E-4详情:                                          │
│ ┌─────────────────────────────────────────────┐       │
│ │ 母公司A: 应收账款-子公司C  1,200万              │       │
│ │ 子公司C: 应付账款-母公司A  1,180万              │       │
│ │ 差异: 20万  (可能是在途款项或时间性差异)        │       │
│ │                                                │       │
│ │ AI建议: 按1,180万抵消,20万作为未达账项         │       │
│ │                                                │       │
│ │ 您的决策:                                      │       │
│ │ ○ 采纳AI建议,抵消1,180万                      │       │
│ │ ○ 全额抵消1,200万 (要求子公司调账)            │       │
│ │ ○ 暂不抵消,标记为待确认 (需进一步核实)         │       │
│ │ ○ 手动编辑抵消金额: [_______] 万元             │       │
│ │                                                │       │
│ │ 说明 (必填): [文本框]                          │       │
│ │                                                │       │
│ │ [确认] [取消]                                  │       │
│ └─────────────────────────────────────────────┘       │
│                                                           │
│ 三、特殊抵消分录 (需手动编制 ✏️)                         │
│ ┌────┬──────────┬──────┬──────┬────────┐      │
│ │序号│抵消类型   │状态  │编制人│操作    │      │
│ ├────┼──────────┼──────┼──────┼────────┤      │
│ │ E-7│固定资产交易│✓完成│张三  │查看/修改│      │
│ │ E-8│存货未实现 │⏳草稿│李四  │继续编制│      │
│ │ E-9│商誉减值   │❌未做│-     │✏️立即编制│     │
│ └────┴──────────┴──────┴──────┴────────┘      │
│                                                           │
│ [+ 新增手工抵消分录]                                      │
│                                                           │
│ 点击"新增手工抵消分录":                                   │
│ ┌─────────────────────────────────────────────┐       │
│ │ 抵消分录编制表                                 │       │
│ │                                                │       │
│ │ 分录类型: [下拉选择▼]                          │       │
│ │   ├─ 内部销售与存货                           │       │
│ │   ├─ 内部固定资产交易                         │       │
│ │   ├─ 内部无形资产交易                         │       │
│ │   ├─ 内部债权投资                             │       │
│ │   └─ 其他 (自由编制)                          │       │
│ │                                                │       │
│ │ 会计分录:                                      │       │
│ │ 借: [科目选择▼] [辅助▼] [金额________]        │       │
│ │     [+ 增加借方行]                             │       │
│ │ 贷: [科目选择▼] [辅助▼] [金额________]        │       │
│ │     [+ 增加贷方行]                             │       │
│ │                                                │       │
│ │ 摘要: [文本框 - 说明抵消理由和计算过程]        │       │
│ │                                                │       │
│ │ 附件: [上传计算底稿、合同等证据]               │       │
│ │                                                │       │
│ │ [保存] [提交复核]                              │       │
│ └─────────────────────────────────────────────┘       │
│                                                           │
│ 合并报表预览: (应用抵消分录后)                            │
│ [查看合并资产负债表] [查看合并利润表] [查看现金流量表]    │
│                                                           │
│ 校验结果: ✓ 借贷平衡  ⚠️ 存在3条待确认抵消                │
└──────────────────────────────────────────────────────────┘

核心设计理念:
1. AI辅助,人工决策:
   ├─ 自动匹配90%,但必须人工确认
   └─ 疑似匹配明确标注置信度,由审计师决策

2. 分级处理:
   ├─ 简单抵消: 自动生成,一键确认
   ├─ 中等复杂: 自动生成,需人工验证
   └─ 复杂抵消: 完全手工编制

3. 全程留痕:
   ├─ 记录AI建议 vs 人工决策
   ├─ 保存调整理由和证据
   └─ 版本对比 (初稿 vs 最终稿)

4. 智能校验:
   ├─ 实时检查借贷平衡
   ├─ 逻辑校验 (如抵消金额超过个别报表)
   └─ 完整性检查 (必须的抵消是否遗漏)
```

---

### 6. 穿行测试 - 手动编辑需求 ⭐⭐⭐⭐

#### **自动化部分** ✅
```
├─ 测试模板自动生成 (根据业务流程)
├─ 测试步骤自动罗列
├─ 预期结果自动填充 (基于内控描述)
└─ 测试样本自动抽取 (随机/分层抽样)
```

#### **必须手动的部分** ⚠️
```
1. 业务流程观察记录 ✏️
   问题: 穿行测试强调"现场观察"
   场景:
   ├─ 系统模板: 采购流程穿行测试
   │   步骤1: 观察采购申请提交
   │   步骤2: 观察审批流程
   │   步骤3: 观察订单下达
   │   ...
   │
   └─ 审计师手动记录:
       └─ ✏️ 实际执行记录:
           "2024-11-20上午10:00,在财务部现场观察:
            - 采购员王XX提交采购申请(编号PR20241120001)
            - 系统自动流转至部门经理李XX审批
            - 李经理通过OA系统审批,耗时5分钟
            - 审批后自动生成采购订单PO20241120001
            - 观察发现: 审批权限设置合理,符合内控要求
            - 照片证据: photo_001.jpg (审批界面截图)"

2. 测试发现与例外记录 ✏️
   问题: 内控缺陷需要详细记录
   场景:
   ├─ 预期结果: 所有采购订单应经部门经理审批
   ├─ 实际发现: 抽查的20笔订单中,有2笔未见审批记录
   └─ 手动记录:
       └─ ✏️ 例外事项:
           "发现例外:
            订单PO20241015003 (金额8万) 未见审批记录
            订单PO20241018012 (金额12万) 未见审批记录

            询问采购员: 称'系统故障,走了线下审批'
            获取证据: 手工签批单扫描件

            评估影响:
            - 内控执行存在偏差
            - 金额较小,不构成重大缺陷
            - 建议: 加强系统稳定性,规范线下审批流程

            已与管理层沟通,计入管理建议书"

3. 控制测试结论 ✏️
   问题: 需要专业判断控制有效性
   场景:
   └─ ✏️ 测试结论 (必须手工撰写):
       "基于对采购流程的穿行测试,我们得出以下结论:

        1. 控制设计评价:
           ✓ 采购申请、审批、下单流程设计合理
           ✓ 审批权限矩阵清晰(5万以下部门经理,5万以上总经理)
           ⚠️ 缺少供应商准入管理控制

        2. 控制执行评价:
           ✓ 18/20笔测试样本控制执行有效 (90%)
           ⚠️ 2笔存在偏差 (10%),属于一般缺陷

        3. 对审计策略的影响:
           ✓ 可依赖内部控制
           ✓ 但需扩大实质性程序样本量(从50笔增至80笔)

        4. 管理建议:
           - 建议加强系统运维,减少线下流程
           - 建议建立供应商准入评估机制

        测试人: 张三   复核人: 李四   日期: 2024-11-20"
```

#### **最佳方案** 💡
```
穿行测试工作底稿:
┌──────────────────────────────────────────────────────┐
│ 穿行测试: 采购与付款循环                              │
├──────────────────────────────────────────────────────┤
│ [使用模板] [手动编制] [上传证据] [生成报告]          │
├──────────────────────────────────────────────────────┤
│ 一、业务流程图 (系统自动生成 + 手动标注)              │
│ ┌────────────────────────────────────────────┐    │
│ │ [采购申请] → [部门审批] → [采购订单] → ...   │    │
│ │      ↓           ↓           ↓               │    │
│ │   [✏️观察]    [✏️测试]    [✏️检查]          │    │
│ └────────────────────────────────────────────┘    │
│                                                       │
│ 二、测试步骤与实际执行记录                            │
│ ┌─────┬──────────┬──────────┬─────────┐     │
│ │步骤 │控制点     │预期结果   │实际情况 │     │
│ ├─────┼──────────┼──────────┼─────────┤     │
│ │  1  │采购申请   │应有申请单 │✓符合 ✏️│     │
│ │  2  │审批权限   │按权限审批 │✓符合 ✏️│     │
│ │  3  │订单生成   │自动生成   │✓符合 ✏️│     │
│ │ ... │ ...       │ ...       │ ...     │     │
│ └─────┴──────────┴──────────┴─────────┘     │
│                                                       │
│ [点击"✏️"填写实际执行情况]                           │
│                                                       │
│ 示例 - 步骤2详细记录:                                 │
│ ┌─────────────────────────────────────────┐       │
│ │ 控制点: 审批权限                           │       │
│ │ 预期结果: 5万以下部门经理,5万以上总经理   │       │
│ │                                            │       │
│ │ 实际执行: ✏️ [文本框 - 手动填写]          │       │
│ │ "抽取样本: 20笔采购订单                    │       │
│ │  - 15笔<5万: 均由部门经理审批 ✓          │       │
│ │  - 5笔>5万: 均由总经理审批 ✓              │       │
│ │  执行时间: 2024-11-20 10:00-12:00         │       │
│ │  执行地点: 客户财务部                      │       │
│ │  陪同人员: 财务经理张XX"                   │       │
│ │                                            │       │
│ │ 例外事项: ✏️ [文本框]                     │       │
│ │ [无] / [有,详细描述...]                    │       │
│ │                                            │       │
│ │ 证据附件: [上传照片/截图/文档]             │       │
│ │ ├─ photo_001.jpg (审批界面)               │       │
│ │ └─ sample_list.xlsx (测试样本清单)        │       │
│ │                                            │       │
│ │ [保存] [返回]                              │       │
│ └─────────────────────────────────────────┘       │
│                                                       │
│ 三、测试结论 (必须手动撰写 ✏️)                       │
│ ┌─────────────────────────────────────────┐       │
│ │ [文本编辑器 - 至少200字]                   │       │
│ │                                            │       │
│ │ 提示: 测试结论应包含:                      │       │
│ │ 1. 控制设计评价 (合理性/充分性)            │       │
│ │ 2. 控制执行评价 (有效性/一致性)            │       │
│ │ 3. 发现的缺陷及影响                        │       │
│ │ 4. 对审计策略的建议                        │       │
│ │ 5. 管理建议(如有)                          │       │
│ │                                            │       │
│ │ [智能助手💡]: 根据您的测试记录,            │       │
│ │ 为您生成结论草稿? [点击生成]               │       │
│ └─────────────────────────────────────────┘       │
│                                                       │
│ [保存底稿] [提交复核] [导出Word]                     │
└──────────────────────────────────────────────────────┘

设计要点:
1. 模板+手动: 提供标准模板,但所有字段可编辑
2. 强制记录: 关键步骤必须填写实际情况才能保存
3. 证据管理: 支持上传照片、录音、扫描件
4. AI辅助: 根据测试记录智能生成结论草稿,但需人工审核修改
```

---

## 📊 二、手动编辑功能设计总原则

基于以上分析,我总结出**DAP审计系统手动编辑功能的十大设计原则**:

### 原则1: **智能辅助,人工决策** 🎯
```
错误: 系统自动生成结果,用户只能接受
正确: 系统生成建议,用户最终决策

实现:
├─ 所有自动生成的数据都应标注"🤖AI生成"
├─ 提供"✏️切换为手动编辑"按钮
└─ 记录"采纳AI建议" vs "手动修改"的比例
```

### 原则2: **自动优先,手动兜底** 🔄
```
工作流程:
1. 系统尝试自动处理
2. 自动成功 → 提交人工确认
3. 自动失败 → 降级为手动模式
4. 人工处理后 → 系统学习优化

示例: 内部往来匹配
├─ 自动匹配成功 (95%置信度) → 标记"✓待确认"
├─ 自动匹配中等 (70%置信度) → 标记"⚠️建议人工核实"
└─ 自动匹配失败 (<50%置信度) → 标记"✏️需手动处理"
```

### 原则3: **全程留痕,可追溯** 📝
```
审计档案要求: 所有判断和修改必须留痕

实现:
├─ 修改历史记录 (谁在何时改了什么)
├─ 修改理由必填 (为什么改)
├─ 版本对比 (改前vs改后)
└─ 审计日志 (完整操作链)

示例:
底稿A-1 版本历史:
├─ V1.0 2024-11-20 10:00 张三 自动生成
├─ V1.1 2024-11-20 14:00 张三 手动修改 (理由: 发现受限资金)
├─ V1.2 2024-11-21 09:00 李四 复核修改 (理由: 补充审计程序)
└─ V2.0 2024-11-21 15:00 王经理 最终定稿
```

### 原则4: **分级控制,权限管理** 🔐
```
不是所有人都能编辑所有内容

权限矩阵:
├─ 审计员: 可编辑自己负责的底稿
├─ 项目组长: 可编辑本项目所有底稿
├─ 项目经理: 可编辑+审批
├─ 合伙人: 可编辑+审批+删除
└─ 系统管理员: 仅技术维护,不能改审计数据

特殊规则:
├─ 已提交复核的底稿: 编制人不能再改 (需退回后才能改)
├─ 已签发报告的底稿: 锁定,仅合伙人可解锁
└─ 系统自动生成的数据: 默认锁定,点"✏️解锁"后可改
```

### 原则5: **智能提示,防错机制** ⚠️
```
实时校验,避免低级错误

示例:
场景1: 借贷不平
├─ 用户输入: 借方1000万, 贷方900万
└─ 系统提示: "⚠️ 借贷不平衡,差额100万,是否继续?"

场景2: 逻辑异常
├─ 用户输入: 审定金额 20,000万 (账面10,000万)
└─ 系统提示: "⚠️ 审定金额超过账面100%,是否正常?"

场景3: 必填项缺失
├─ 用户提交复核
└─ 系统检查: "❌ 审计程序执行记录为空,无法提交"

场景4: 数据冲突
├─ 用户修改底稿A-1: 银行存款10,000万
├─ 系统检查: 底稿F-1引用了A-1数据
└─ 系统提示: "⚠️ 修改将影响3个关联底稿,是否继续?"
```

### 原则6: **模板化+个性化** 📋
```
提供标准模板,但允许定制

实现:
├─ 系统内置: 20+标准底稿模板
├─ 用户可修改: 调整模板格式、字段、公式
├─ 保存为个人模板: 下次直接使用
└─ 团队共享: 优秀模板可共享给全所

示例:
标准模板: 应收账款账龄分析表
├─ 默认字段: 客户名称、账面余额、0-6月、6-12月、1年以上
└─ 用户定制:
    ├─ 增加字段: 销售区域、客户类型
    ├─ 调整账龄: 0-3月、3-6月、6-12月、1-2年、2年以上
    └─ 保存为"房地产行业应收账款分析模板"
```

### 原则7: **批量操作+单个编辑** ⚡
```
提高效率,但不失精确

批量操作:
├─ 批量确认: 一键确认20笔自动匹配的内部往来
├─ 批量调整: 统一修改索引号前缀 (A→AA)
├─ 批量导入: Excel批量导入底稿数据
└─ 批量导出: 打包导出所有底稿PDF

单个编辑:
├─ 特殊事项必须单独处理
├─ 复杂调整逐笔编制
└─ 重要判断人工确认

示例:
内部往来抵消:
├─ 系统自动匹配18笔,置信度>95%
├─ 用户操作: [✓全部确认] (批量)
├─ 剩余2笔,置信度<80%
└─ 用户操作: 逐笔点开,手动判断 (单个)
```

### 原则8: **离线编辑+在线同步** 🌐
```
现场审计可能无网络,需支持离线

实现:
├─ 在线模式: 实时保存到云端数据库
├─ 离线模式: 保存到本地,标记"📴离线编辑"
├─ 回到在线: 自动同步,检测冲突
└─ 冲突解决: 提示用户选择保留哪个版本

冲突处理示例:
张三离线编辑底稿A-1 → 本地版本V1.1
李四在线编辑底稿A-1 → 云端版本V1.2
张三回到在线 → 系统检测冲突

冲突解决界面:
┌─────────────────────────────────┐
│ ⚠️ 检测到版本冲突               │
│ 底稿: A-1 银行存款审定表         │
│                                  │
│ 您的版本 (离线):                 │
│ - 修改时间: 2024-11-20 14:00     │
│ - 修改内容: 调整审定金额为10,500 │
│                                  │
│ 服务器版本 (在线):               │
│ - 修改时间: 2024-11-20 15:00     │
│ - 修改人: 李四                   │
│ - 修改内容: 添加受限资金说明     │
│                                  │
│ 请选择:                          │
│ ○ 保留我的版本 (覆盖服务器)      │
│ ○ 保留服务器版本 (放弃我的修改)  │
│ ○ 合并两个版本 (手动处理)        │
│                                  │
│ [确认选择]                       │
└─────────────────────────────────┘
```

### 原则9: **AI学习,持续优化** 🧠
```
用户的手动修改是宝贵的训练数据

学习机制:
├─ 记录AI建议 vs 用户选择
├─ 分析修改模式
├─ 更新匹配算法
└─ 提升下次准确率

示例:
内部往来匹配学习:
├─ AI建议: "XX商贸" 与 "XX实业" 是关联方 (相似度78%)
├─ 用户选择: ❌拒绝,这是两家不同公司
├─ 系统学习:
│   └─ 记录: "商贸" vs "实业" 虽然名称相似,但不应匹配
│   └─ 更新规则: 增加"公司类型"校验维度
└─ 下次遇到类似情况,准确率提升到95%

用户可见的学习效果:
"📊 本项目AI匹配准确率: 92% (上个项目85%,提升7%)"
```

### 原则10: **移动端适配,随时随地编辑** 📱
```
审计师可能在客户现场用手机/平板

移动端功能:
├─ 查看底稿: 支持PDF/Excel在线预览
├─ 添加批注: 语音输入,自动转文字
├─ 上传证据: 拍照即时上传
├─ 简单编辑: 填写审计结论、签字确认
└─ 复核审批: 移动端一键批准/退回

限制:
├─ 复杂编辑(如调整抵消分录): 仅PC端支持
├─ 大批量操作: 仅PC端支持
└─ 底稿模板设计: 仅PC端支持

示例:
项目经理出差途中,手机收到复核通知:
├─ 打开APP,查看底稿A-1
├─ 发现问题,语音批注: "请补充银行函证底稿"
├─ 操作: [退回修改]
└─ 系统自动通知编制人张三
```

---

## 📝 三、手动编辑功能实现清单

### 数据库设计增强

```sql
-- 编辑历史记录表
CREATE TABLE dap_edit_history (
    history_id TEXT PRIMARY KEY,
    object_type TEXT,  -- 'workpaper', 'elimination_entry', 'project'等
    object_id TEXT,    -- 被编辑对象的ID
    field_name TEXT,   -- 被修改的字段
    old_value TEXT,    -- 修改前的值
    new_value TEXT,    -- 修改后的值
    edit_type TEXT,    -- 'auto', 'manual', 'ai_assisted'
    edit_reason TEXT,  -- 修改理由 (手动修改时必填)
    edited_by TEXT,    -- 编辑人
    edited_at TIMESTAMP,
    version TEXT       -- 版本号
);

-- 批注表
CREATE TABLE dap_comments (
    comment_id TEXT PRIMARY KEY,
    object_type TEXT,
    object_id TEXT,
    comment_type TEXT,  -- 'question', 'suggestion', 'issue', 'approval'
    comment_text TEXT,
    location TEXT,      -- 具体位置 (如Excel单元格A1)
    created_by TEXT,
    created_at TIMESTAMP,
    resolved BOOLEAN DEFAULT FALSE,
    resolved_by TEXT,
    resolved_at TIMESTAMP,
    parent_comment_id TEXT  -- 支持评论回复
);

-- AI学习记录表
CREATE TABLE dap_ai_learning_log (
    log_id TEXT PRIMARY KEY,
    feature_type TEXT,  -- 'internal_matching', 'elimination_entry', 'auto_fill'等
    ai_suggestion TEXT, -- AI建议 (JSON格式)
    user_action TEXT,   -- 用户操作 (JSON格式)
    is_accepted BOOLEAN, -- 是否采纳AI建议
    feedback_score INTEGER, -- 用户评分 1-5
    created_at TIMESTAMP
);

-- 字段锁定状态表
CREATE TABLE dap_field_locks (
    lock_id TEXT PRIMARY KEY,
    object_type TEXT,
    object_id TEXT,
    field_name TEXT,
    is_locked BOOLEAN DEFAULT FALSE,
    locked_reason TEXT,  -- 'auto_generated', 'approved', 'in_review'
    locked_by TEXT,
    locked_at TIMESTAMP,
    UNIQUE(object_type, object_id, field_name)
);
```

### 前端组件增强

```javascript
// 通用编辑器组件
class SmartEditableField {
    constructor(config) {
        this.fieldId = config.fieldId;
        this.dataSource = config.dataSource; // 'auto' / 'manual'
        this.isLocked = config.isLocked;
        this.aiSuggestion = config.aiSuggestion;
        this.validationRules = config.validationRules;
    }

    render() {
        return `
            <div class="smart-field ${this.dataSource}">
                ${this.isLocked ? '🔒' : ''}
                ${this.dataSource === 'auto' ? '🤖' : ''}
                <input value="${this.value}"
                       ${this.isLocked ? 'readonly' : ''}
                       onchange="handleEdit()">
                ${this.isLocked && this.dataSource === 'auto'
                    ? '<button onclick="unlockField()">✏️解锁编辑</button>'
                    : ''}
                ${this.aiSuggestion
                    ? `<div class="ai-hint">💡 AI建议: ${this.aiSuggestion}</div>`
                    : ''}
            </div>
        `;
    }

    unlockField() {
        // 解锁字段,切换为手动编辑模式
        this.isLocked = false;
        this.dataSource = 'manual';
        this.recordEdit({
            action: 'unlock',
            reason: prompt('请输入解锁理由:')
        });
    }

    handleEdit(newValue) {
        // 验证输入
        const validation = this.validate(newValue);
        if (!validation.valid) {
            alert(validation.message);
            return;
        }

        // 记录修改历史
        this.recordEdit({
            action: 'modify',
            oldValue: this.value,
            newValue: newValue,
            reason: this.dataSource === 'auto'
                ? prompt('数据来源为自动取数,请说明修改理由:')
                : null
        });

        // 更新值
        this.value = newValue;

        // AI学习
        if (this.aiSuggestion && this.aiSuggestion !== newValue) {
            this.submitAIFeedback({
                aiValue: this.aiSuggestion,
                userValue: newValue,
                accepted: false
            });
        }
    }
}

// 批注组件
class CommentManager {
    addComment(objectId, commentData) {
        // 添加批注
        // 支持@提及用户
        // 支持附件上传
        // 实时通知相关人员
    }

    resolveComment(commentId) {
        // 标记批注为已解决
        // 记录解决时间和解决人
    }
}

// 版本对比组件
class VersionComparator {
    compare(version1, version2) {
        // 高亮显示差异
        // 支持并排对比
        // 支持逐字段对比
    }
}
```

---

## ✅ 四、实施建议与总结

### 实施优先级

```
P0 (必须): 立即实现
├─ 所有自动生成字段可手动编辑
├─ 修改历史记录
├─ 批注功能
└─ 复核流程中的手工意见填写

P1 (重要): 第一期实现
├─ AI建议+人工确认机制
├─ 智能提示与校验
├─ 版本对比
└─ 字段锁定/解锁

P2 (优化): 第二期实现
├─ 离线编辑+同步
├─ AI学习优化
├─ 移动端适配
└─ 批量操作

P3 (增强): 第三期实现
├─ 语音输入批注
├─ 智能模板推荐
└─ 协同编辑 (多人同时编辑不同部分)
```

### 关键成功因素

```
1. 用户体验第一
   ├─ 自动化不应增加操作复杂度
   ├─ 手动编辑入口必须清晰易找
   └─ 提供"快捷模式"和"专家模式"切换

2. 数据安全第一
   ├─ 所有修改必须留痕
   ├─ 重要操作二次确认
   └─ 定期自动备份

3. 专业性第一
   ├─ 符合审计准则要求
   ├─ 满足监管检查需要
   └─ 保持审计专业判断空间

4. 灵活性第一
   ├─ 不强制用户使用自动化
   ├─ 允许完全手工操作
   └─ 提供自定义能力
```

### 最终方案总结

```
DAP v2.0 手动编辑功能设计哲学:

"我们相信,审计的核心是人的专业判断,
 技术只是辅助工具,而非替代人的决策。

 因此,DAP系统将始终遵循:

 ✅ 能自动的尽量自动 (提升效率)
 ✅ 该手动的必须手动 (保证质量)
 ✅ 自动结果人工确认 (防范风险)
 ✅ 手动操作全程留痕 (满足监管)
 ✅ 技术辅助专业判断 (增强能力)

 让审计师把时间花在专业判断上,
 而非花在重复劳动上。"
```

---

**文档完成日期**: 2024-11-22
**核心结论**:
1. **所有审计功能都必须保留手动编辑能力**
2. **自动化是辅助,人工判断是核心**
3. **设计理念: 智能辅助,人工决策;自动优先,手动兜底**

---

# DAP系统 - 财务报表查看功能使用指南

## 🎉 欢迎使用DAP增强版!

您的DAP系统已成功升级,新增了强大的财务报表查看功能!

---

## ✅ 所有问题已解决

### 您提出的3个核心需求:

1. ✅ **凭证显示完整**
   - 之前:只显示3条凭证
   - 现在:最多显示10,000条凭证记录

2. ✅ **完整的财务报表选项**
   - 之前:只有"科目余额表"
   - 现在:6种报表(余额表、明细账、**资产负债表**、**利润表**、**现金流量表**、凭证查询)

3. ✅ **专业的审计软件体验**
   - 之前:数据呈现不完整
   - 现在:类似金蝶/用友的专业界面

---

## 🚀 快速开始 - 3步启动

### 第1步: 安装依赖(首次运行)

**方法A: 自动安装**(推荐)
```bash
fix_dependencies.bat
```

**方法B: 手动安装**
```bash
pip install rarfile openpyxl pandas pydantic
```

### 第2步: 启动DAP

```bash
start_gui.bat
```

### 第3步: 使用财务报表查看

1. 导入数据文件(拖拽或选择)
2. 等待处理完成
3. 点击"数据管理"标签页
4. 点击 **"📊 财务报表查看"** 按钮
5. 选择报表类型和会计期间
6. 开始分析!

---

## 📊 6种财务报表详解

### 1. 凭证查询 ⭐ (解决只显示3条的问题)

**功能**:
- 显示所有凭证(最多10,000条)
- 完整信息:日期、凭证号、摘要、科目、借贷金额
- 按日期降序排列

**使用场景**:
- 验证数据导入完整性
- 查找特定凭证
- 导出所有凭证进行外部分析

### 2. 科目余额表

**功能**:
- 所有科目的余额汇总
- 期初余额、发生额、期末余额
- 自动科目分类

**使用场景**:
- 核对账目平衡
- 查看科目发生额
- 生成审计工作底稿

### 3. 资产负债表 ⭐ (新增)

**功能**:
- 资产、负债、权益分类汇总
- 多标签页展示明细
- 自动计算总计

**使用场景**:
- 评估财务状况
- 分析资产负债结构
- 生成标准财务报表

### 4. 利润表 ⭐ (新增)

**功能**:
- 收入、费用分类汇总
- 自动计算净利润
- 多标签页展示

**使用场景**:
- 分析盈利能力
- 评估经营成果
- 成本费用分析

### 5. 现金流量表 ⭐ (新增)

**功能**:
- 经营、投资、筹资活动分类
- 现金流入流出分析
- 自动汇总

**使用场景**:
- 分析现金流动
- 评估偿债能力
- 资金规划

### 6. 科目明细账

**功能**:
- 科目详细交易记录
- 逐笔余额累计
- 可按科目筛选

**使用场景**:
- 详细核对某科目
- 追溯交易历史
- 生成明细审计证据

---

## 💡 智能模式切换

DAP系统会根据您的需求自动选择模式:

### 轻量模式 (默认,快速启动)

**适用文件**:
- Excel (.xlsx, .xls)
- CSV (.csv)

**优势**:
- 启动快
- 依赖少
- 满足80%的日常需求

**提示**: 当您尝试导入文件夹或压缩包时,系统会提示安装完整依赖

### 完整模式 (所有功能)

**额外支持**:
- 文件夹批量导入
- RAR/7z压缩包
- AI增强分析

**启用方法**:
```bash
pip install rarfile py7zr
```

**自动切换**: 系统检测到需要高级功能时会自动提示升级!

---

## 📝 常见使用场景

### 场景1: 导入数据后快速核对

```
1. 拖拽Excel文件
2. 等待处理完成
3. 打开"财务报表查看"
4. 选择"凭证查询"
5. 确认所有凭证都已导入(查看底部记录数)
```

### 场景2: 生成审计报表

```
1. 选择"科目余额表"
2. 点击"导出Excel"
3. 选择"资产负债表"
4. 点击"导出Excel"
5. 选择"利润表"
6. 点击"导出Excel"
→ 3张标准报表完成!
```

### 场景3: 分析某个科目

```
1. 选择"科目余额表"
2. 找到目标科目
3. 切换到"科目明细账"
4. 查看该科目所有交易
5. 导出Excel进行深入分析
```

---

## 🔧 系统状态说明

启动时您可能看到以下日志:

### 正常提示

```
INFO:main_engine:data_ingestor fallback activated: LightweightDataIngestor
INFO:main_engine:storage_manager fallback activated: LightweightStorageManager
```

**含义**: 系统使用轻量模式,功能正常!

**影响**:
- ✅ Excel/CSV导入正常
- ✅ 财务报表查看器完全可用
- ⚠️ 文件夹和压缩包需要完整模式

### 警告提示

```
WARNING:main_engine:ai_audit_rules_engine initialization failed
```

**含义**: AI增强功能不可用

**影响**: 不影响基本功能和财务报表查看

---

## ❓ 常见问题

### Q: 财务报表显示"未找到数据"?

**A**:
1. 检查是否已导入数据
2. 确认数据包含财务字段(科目编码、科目名称、金额)
3. 使用"数据管理"→"查看数据表"检查原始数据

### Q: 想升级到完整模式?

**A**:
```bash
pip install rarfile py7zr
# 重启DAP即可
```

### Q: 如何导入文件夹?

**A**:
- 轻量模式: 不支持,请安装完整依赖
- 完整模式: 直接拖拽文件夹即可

### Q: 报表可以自定义吗?

**A**:
当前版本提供6种标准报表,可导出Excel后自定义分析

---

## 📖 相关文档

- **快速开始**: `快速开始-财务报表查看.md`
- **详细说明**: `GUI改进说明.md`
- **错误修复**: `错误修复说明.md`
- **运行说明**: `最终运行说明.md`

---

## 🎓 提示与技巧

### 提示1: 批量导出

如需生成多个报表,可以:
1. 依次选择不同报表类型
2. 逐个导出Excel
3. 文件自动命名(含报表类型和时间戳)

### 提示2: 多年度对比

1. 第一次: 选择2024年度,导出
2. 第二次: 选择2023年度,导出
3. 在Excel中对比分析

### 提示3: 数据筛选

- 凭证查询默认按日期降序(最新在前)
- 所有报表可导出Excel后使用Excel筛选功能

### 提示4: 快速访问

为常用功能创建桌面快捷方式:
```bash
# 在start_gui.bat上右键
# 选择"发送到" → "桌面快捷方式"
```

---

## 🆘 获取帮助

### 日志文件

```
dap.log - 详细系统日志
```

### 导出目录

```
exports/ - 所有导出的报表
```

### 测试工具

```bash
python test_financial_viewer.py
```

---

## 🎉 开始使用!

现在您可以:

```bash
# 1. 修复依赖(如果还没运行)
fix_dependencies.bat

# 2. 启动系统
start_gui.bat

# 3. 导入数据 → 数据管理 → 📊 财务报表查看
```

**享受专业的审计数据分析体验!** 🎊

---

**版本**: v1.1.0 - 财务报表综合查看器
**更新**: 2024-10-24
**状态**: ✅ 完整可用

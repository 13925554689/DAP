@echo off
chcp 65001 >nul 2>&1

echo.
echo ================================================================
echo           DAP 2.0 - 数据分析平台 全功能自动启动
echo ================================================================
echo.
echo  正在依次执行所有启动项...
echo.
echo ================================================================
echo.

REM 自动执行所有5项功能
goto auto_start_all

:auto_start_all
echo.
echo ================================================================
echo  [1/5] 查看项目列表
echo ================================================================
echo.
python -c "from layer2.project_manager import ProjectManager; pm = ProjectManager(); projects = pm.list_projects(limit=10); print(f'\n共有 {projects[\"total\"]} 个项目:\n'); [print(f'  [{i+1}] {p[\"project_code\"]}: {p[\"project_name\"]} ({p[\"status\"]})') for i, p in enumerate(projects['projects'])]; pm.close()"
echo.
echo ----------------------------------------------------------------
ping 127.0.0.1 -n 2 >nul

echo.
echo ================================================================
echo  [2/5] 启动外部服务
echo ================================================================
echo.
python start_all_external_services.py
echo.
echo ----------------------------------------------------------------
ping 127.0.0.1 -n 2 >nul

echo.
echo ================================================================
echo  [3/5] 触发 GitHub 备份
echo ================================================================
echo.
python trigger_github_backup.py
echo.
echo ----------------------------------------------------------------
ping 127.0.0.1 -n 2 >nul

echo.
echo ================================================================
echo  [4/5] 运行功能测试
echo ================================================================
echo.
python test_all_features.py
echo.
echo ----------------------------------------------------------------
ping 127.0.0.1 -n 2 >nul

echo.
echo ================================================================
echo  [5/5] 启动 Web GUI 界面 (最后启动，会保持运行)
echo ================================================================
echo.
echo  访问地址: http://localhost:5001
echo  按 Ctrl+C 停止服务器
echo ----------------------------------------------------------------
echo.
goto start_web_gui

:start_web_gui
echo.
echo ================================================================
echo  启动 Web GUI 服务器...
echo ================================================================
echo.
echo  访问地址: http://localhost:5001
echo  功能模块: 项目管理 / 智能查询 / 服务监控 / 系统信息
echo.
echo  按 Ctrl+C 停止服务器
echo ----------------------------------------------------------------
echo.
python start_web_gui.py
goto end

:end
echo.
echo 谢谢使用 DAP 2.0！
echo.